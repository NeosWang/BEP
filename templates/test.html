<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>JBP 000</title>
    <!-- STYLES -->
    <!-- {{ fontawesome_html() }} -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nouislider.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">

 

    <!-- /STYLES -->
    <!-- SCRIPTS -->
    <script src="{{ url_for('static', filename='js/echarts.min.js')}}"></script>
    <script src="{{ url_for('static', filename='js/nouislider.js')}}"></script>
    <script src="{{ url_for('static', filename='js/vis.js')}}"></script>
    <script src="{{ url_for('static', filename='js/yc.js')}}"></script>
    <script src="{{ url_for('static', filename='js/dn.js')}}"></script>

    <!-- /SCRIPTS -->



</head>

<body>
    <div class="grid_container">
        <div id="network" class="network"></div>

        <div id="side" class="side">


            <br><br><br><br><br><br>
            <label for="lname">idx:</label>
            <input type="text" id="input-idx" name="input-idx"><br><br>

            <input type="radio" id="union" name="merge" onclick="unionRadio(this)" value="1" checked />
            <label for="union">union</label><br>
            <input type="radio" id="intersection" name="merge" onclick="unionRadio(this)" value="0">
            <label for="intersection">intersection</label><br>
            <br><br>
            <select id="featureSelector" onchange="featureSelect(this)">
                <option value="class" selected>class</option>
                <option value="gender">gender</option>
            </select>
        </div>

        <div id="range-slider-box" class="range-slider-box">
            <span class="bottomright">
                <button class='btn' value = '-1' onclick="move(this.value)">
                    <i class="fa fa-step-backward" aria-hidden="true"></i>
                </button>
                <button class='btn' value='0' onclick="playOrPause(this)">
                    <i id="play-or-pause" class="fa fa-play" aria-hidden="true"></i>
                </button>
                <button id="btn-forward" class='btn' value = '1' onclick="move(this.value)">
                    <i class="fa fa-step-forward" aria-hidden="true"></i>
                </button>
            </span>

            <div id="range-slider" class="range-slider"></div>
        </div>

        <div id="range-slider-side" class="range-slider-side">
            <div style="height: 50%;">
                <select id="handles" onchange="handlersSelect(this)">
                    <option class="imagebacked" style="background-image: url(/static/img/try.png);" value="1"  selected>discrete</option>
                    <option value="2" >continuous</option>
                    <option value="-3" >continuous(arise)</option>
                    <option value="3"> continuous(die out) </option>
                </select>
            </div>
            <div style="height: 50%;">
                shit
            </div>





        </div>

        <div id="timeline" class="timeline"></div>

        <div id="timeline-side-zoom-range" class="timeline-side-zoom-range">
            <legend>Zoom range:</legend>
            <div class="block">
                <label for="zoom-select">from</label>
                <select id="zoom-from" name="zoom-select" onchange="changeDataZoom()"></select>
            </div>
            <div class="block">
                <label for="zoom-select">to</label>
                <select id="zoom-to" name="zoom-select" onchange="changeDataZoom()"></select>
            </div>
        </div>
        <div id="timeline-side-measures" class="timeline-side-measures">
            <legend>Measurements:</legend>
            <input type="checkbox" class="cbxMeasurement" name="active nodes" value='0'
                onclick="selectMeasurements()" /> active nodes <br />
            <input type="checkbox" class="cbxMeasurement" name="active nodes (pct)" value='1'
                onclick="selectMeasurements()" /> active nodes (pct) <br />
            <input type="checkbox" class="cbxMeasurement" name="active relations" value='2'
                onclick="selectMeasurements()" /> active relations <br />
            <input type="checkbox" class="cbxMeasurement" name="active density" value='3'
                onclick="selectMeasurements()" /> active density <br />
            <input type="checkbox" class="cbxMeasurement" name="maximum clique" value='4'
                onclick="selectMeasurements()" /> maximum clique <br />
            <input type="checkbox" class="cbxMeasurement" name="disconnected groups" value='5'
                onclick="selectMeasurements()" /> disconnected groups <br />
        </div>
    </div>


    <script>




        /* global variable*/
        var gIsUnion = true;
        var gCate = document.getElementById('featureSelector').value;
        var gGraph;
        var gGraphAdj;
        var gMeasurements = {}; //{0ï¼š{data,name,show}}

        var dn = DynamicNetwork()


        const gArrayFuncMeasurements = {
            0: dn.getListNrOfVertices,
            1: dn.getListPctOfVertices,
            2: dn.getListNrOfEdges,
            3: dn.getListActiveDensity,
            4: dn.getListMaximumClique,
            5: dn.getListNrOfdisconnected
        }



        function move(ctlValue){
            slider.translation( parseInt(ctlValue));
        }

        var autoPlay= new yc.MySetInterval(function(){move(1)},1200);

        function playOrPause(btn){   
            let ico = document.getElementById("play-or-pause");
            if (btn.value=='0'){
                ico.classList.remove('fa-play'); 
                ico.classList.add('fa-pause');
                autoPlay.play();
                btn.setAttribute("value", "1");
            }else{
                ico.classList.remove('fa-pause');
                ico.classList.add('fa-play'); 
                autoPlay.pause();
                btn.setAttribute("value", "0");
            }
        }

        




        /*function on controls*/
        function selectMeasurements() {
            let checkedBoxes = document.querySelectorAll('input[class=cbxMeasurement]:checked');
            Object.entries(gMeasurements).forEach(([k, v]) => { v.show = false })
            checkedBoxes.forEach(e => {
                let key = e.value;
                let name = e.name
                let show = e.checked;

                if (!gMeasurements.hasOwnProperty(key)) {
                    gMeasurements[key] = {
                        data: gArrayFuncMeasurements[key](),
                        name: name
                    }
                }
                gMeasurements[key].show = show;
            });
            line.updateTimeline();
        }

        function featureSelect(select) {
            gCate = select.value;
            network.update(dn.serialize(gGraph, false, gCate), gCate);
        }

        function unionRadio(radioBtn) {
            gIsUnion = parseInt(radioBtn.value);
        }

        function handlersSelect(select) {
            slider.updateHandles(parseInt(select.value), line.dataZoomBoundary());
            slider.bindNetwork(network);
        }

        function changeDataZoom() {
            let dataZoomSelectors = document.getElementsByName("zoom-select");
            let idxFrom = dataZoomSelectors[0].selectedIndex;
            let idxTo = dataZoomSelectors[1].selectedIndex;
            if (idxFrom > idxTo) {
                dataZoomSelectors[0].selectedIndex = idxTo;
                dataZoomSelectors[1].selectedIndex = idxFrom;
            }
            line.update({
                dataZoom: {
                    startValue: dataZoomSelectors[0].selectedIndex,
                    endValue: dataZoomSelectors[1].selectedIndex
                }
            });
            slider.setRange(line.dataZoomBoundary());
        }






        var links = JSON.parse('{{ links | safe}}').map(u => ({ t: u.t, i: u.i, j: u.j }));
        var nodes = JSON.parse('{{ nodes | safe}}');

        dn.addNodes(nodes)
        dn.addRelationships(links)

        const timeData = dn.getTimeline();

        var zoomFrom = document.getElementById("zoom-from")
        var zoomTo = document.getElementById("zoom-to")

        timeData.forEach((e, i) => {
            let optionF = document.createElement("option");
            let optionT = document.createElement("option");
            optionF.textContent = e;
            optionT.textContent = e;
            optionF.value = e;
            optionT.value = e;
            zoomFrom.appendChild(optionF);
            zoomTo.appendChild(optionT);
        });
        zoomFrom.selectedIndex = 0;
        zoomTo.selectedIndex = timeData.length - 1;




        var line = new vis.LineSummary('timeline')
        var network = new vis.Network('network')




        var slider = new vis.Slider('range-slider', line.dataZoomBoundary(), 1)

        line.triggerRangeSlider(slider, zoomFrom, zoomTo);
        slider.bindNetwork(network);







        // resize diagram
        window.onresize = function () {
            line.resize();
            network.resize();
        }




    </script>


</body>

</html>