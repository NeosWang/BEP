<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>JBP 000</title>
    <!-- STYLES -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="../static/css/main.css">
    <!-- /STYLES -->
    <!-- SCRIPTS -->
    <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
    <script src="{{ url_for('static', filename='js/echarts.min.js')}}"></script>
    <script src="{{ url_for('static', filename='js/yichen.js')}}"></script>
    <script src="{{ url_for('static', filename='js/dn.js')}}"></script>
    <!-- <script src="{{ url_for('static', filename='js/graph.js')}}"></script> -->

    <!-- /SCRIPTS -->



</head>

<body>
    <div class="grid_container">
		<div id = "network" class="network">network plot</div>
		<div class="side">side bar</div>
		<div class="timeline">timeline</div>

	</div>



    <script>


        var links = JSON.parse('{{ links | safe}}').map(u => ({ t: u.t, i: u.i, j: u.j }));
        var nodes = JSON.parse('{{ nodes | safe}}');
        const data = yc.countByKey(links,'t')

        const nrLinks = yc.getListByKey(data,'l')
        

        var dn = DynamicNetwork()
        dn.addNodes(nodes)
        dn.addRelationships(links)

        const timeData = dn.getTimeline()
        const nrNodes = dn.getListNrOfVertices()

        var chartDom = document.getElementById('network');
        var myChart = echarts.init(chartDom);
        var option;

        option = {
            title: {
                text: 'number of active individuals and relations(to be replace by clique)',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    animation: false
                }
            },
            legend: {
                data: ['individuals', 'relations'],
                left: 10
            },
            toolbox: {
                feature: {
                    dataZoom: {
                        yAxisIndex: 'none'
                    },
                    restore: {},
                    saveAsImage: {}
                }
            },
            axisPointer: {
                link: { xAxisIndex: 'all' }
            },
            dataZoom: [
                {
                    show: true,
                    realtime: true,
                    // start: 30,
                    // end: 70,
                    xAxisIndex: [0, 1]
                },
                {
                    type: 'inside',
                    realtime: true,
                    // start: 30,
                    // end: 70,
                    xAxisIndex: [0, 1]
                }
            ],
            grid: [{
                left: 50,
                right: 50,
                height: '35%'
            }, {
                left: 50,
                right: 50,
                top: '52%',
                height: '35%'
            }],
            xAxis: [
                {
                    type: 'category',
                    boundaryGap: false,
                    axisLine: { onZero: true },
                    data: timeData
                },
                {
                    gridIndex: 1,
                    type: 'category',
                    boundaryGap: false,
                    axisLine: { onZero: true },
                    data: timeData,
                    position: 'top',
                    // axisLabel:{
                    //     show:false
                    // }
                }
            ],
            yAxis: [
                {
                    name: '',
                    type: 'value',
                    max: yc.getMax(nrNodes)
                },
                {
                    gridIndex: 1,
                    name: '',
                    type: 'value',
                    max: yc.getMax(nrLinks),
                    inverse: true
                }
            ],
            series: [
                {
                    name: 'individuals',
                    type: 'line',
                    symbolSize: 8,
                    hoverAnimation: false,
                    data: nrNodes

                },
                {
                    name: 'relations',
                    type: 'line',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    symbolSize: 8,
                    hoverAnimation: false,
                    data: nrLinks
                }
            ]
        };

        option && myChart.setOption(option);




        window.onresize = function(){myChart.resize();}
 


    </script>
</body>

</html>